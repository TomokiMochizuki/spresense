/****************************************************************************
 * Copyright 2023 Sony Semiconductor Solutions Corporation
 *
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.  The
 * ASF licenses this file to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance with the
 * License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the
 * License for the specific language governing permissions and limitations
 * under the License.
 *
 ****************************************************************************/
#include <stddef.h>
#include <stdlib.h>
#include <stdio.h>
#include <assert.h>
#include "mossfw/mossfw_component.h"
#include "mossfw/sensorlib.h"
#include "component.h"
#include "attitude_error_source.h"
#include "attitude_error_lpf.h"
#include "attitude_error_complementaryfilter.h"
#include "attitude_error.h"

#define ATTITUDESOURCE_ACC_OUTPUTTYPE  (MOSSFW_DATA_TYPE_SHORT + \
                                        MOSSFW_DATA_TYPEGRP_V3 + \
                                        MOSSFW_DATA_TYPENAME_ACCEL + \
                                        MOSSFW_DATA_TYPEARRAY_SINGLE)
#define ATTITUDESOURCE_GYR_OUTPUTTYPE  (MOSSFW_DATA_TYPE_SHORT + \
                                        MOSSFW_DATA_TYPEGRP_V3 + \
                                        MOSSFW_DATA_TYPENAME_GYRO + \
                                        MOSSFW_DATA_TYPEARRAY_SINGLE)

static mossfw_allocator_t *allocator = NULL;

static mossfw_onedata_t acc10[] = {
  {.v3s = {.x =  30, .y = 2088,  .z = 535}},
  {.v3s = {.x =  25, .y = 2077,  .z = 523}},
  {.v3s = {.x =  25, .y = 2077,  .z = 523}},
  {.v3s = {.x =  22, .y = 2093,  .z = 512}},
  {.v3s = {.x =  22, .y = 2093,  .z = 512}},
  {.v3s = {.x =  14, .y = 2093,  .z = 521}},
  {.v3s = {.x =  14, .y = 2093,  .z = 521}},
  {.v3s = {.x =  30, .y = 2093,  .z = 521}},
  {.v3s = {.x =  30, .y = 2093,  .z = 521}},
  {.v3s = {.x =  15, .y = 2085,  .z = 528}},
  {.v3s = {.x =  15, .y = 2085,  .z = 528}},
  {.v3s = {.x =  30, .y = 2099,  .z = 525}},
  {.v3s = {.x =  30, .y = 2099,  .z = 525}},
  {.v3s = {.x =  13, .y = 2095,  .z = 529}},
  {.v3s = {.x =  13, .y = 2095,  .z = 529}},
  {.v3s = {.x =  29, .y = 2093,  .z = 535}},
  {.v3s = {.x =  29, .y = 2093,  .z = 535}},
  {.v3s = {.x =  47, .y = 2085,  .z = 515}},
  {.v3s = {.x =  47, .y = 2085,  .z = 515}},
  {.v3s = {.x =  22, .y = 2087,  .z = 546}},
  {.v3s = {.x =  22, .y = 2087,  .z = 546}},
  {.v3s = {.x =  14, .y = 2076,  .z = 541}},
  {.v3s = {.x =  14, .y = 2076,  .z = 541}},
  {.v3s = {.x =  34, .y = 2065,  .z = 509}},
  {.v3s = {.x =  34, .y = 2065,  .z = 509}},
  {.v3s = {.x =  40, .y = 2075,  .z = 547}},
  {.v3s = {.x =  40, .y = 2075,  .z = 547}},
  {.v3s = {.x =  35, .y = 2089,  .z = 519}},
  {.v3s = {.x =  35, .y = 2089,  .z = 519}},
  {.v3s = {.x =  42, .y = 2079,  .z = 543}},
  {.v3s = {.x =  42, .y = 2079,  .z = 543}},
  {.v3s = {.x =  24, .y = 2071,  .z = 539}},
  {.v3s = {.x =  24, .y = 2071,  .z = 539}},
  {.v3s = {.x =  50, .y = 2086,  .z = 527}},
  {.v3s = {.x =  50, .y = 2086,  .z = 527}},
  {.v3s = {.x =  41, .y = 2078,  .z = 537}},
  {.v3s = {.x =  41, .y = 2078,  .z = 537}},
  {.v3s = {.x =  52, .y = 2082,  .z = 543}},
  {.v3s = {.x =  52, .y = 2082,  .z = 543}},
  {.v3s = {.x =  37, .y = 2081,  .z = 530}},
  {.v3s = {.x =  37, .y = 2081,  .z = 530}},
  {.v3s = {.x =  46, .y = 2085,  .z = 557}},
  {.v3s = {.x =  46, .y = 2085,  .z = 557}},
  {.v3s = {.x =  50, .y = 2096,  .z = 521}},
  {.v3s = {.x =  50, .y = 2096,  .z = 521}},
  {.v3s = {.x =  62, .y = 2077,  .z = 555}},
  {.v3s = {.x =  62, .y = 2077,  .z = 555}},
  {.v3s = {.x =  53, .y = 2092,  .z = 546}},
  {.v3s = {.x =  53, .y = 2092,  .z = 546}},
  {.v3s = {.x =  62, .y = 2089,  .z = 548}},
  {.v3s = {.x =  62, .y = 2089,  .z = 548}},
  {.v3s = {.x =  62, .y = 2080,  .z = 555}},
  {.v3s = {.x =  62, .y = 2080,  .z = 555}},
  {.v3s = {.x =  77, .y = 2093,  .z = 561}},
  {.v3s = {.x =  77, .y = 2093,  .z = 561}},
  {.v3s = {.x =  82, .y = 2078,  .z = 522}},
  {.v3s = {.x =  82, .y = 2078,  .z = 522}},
  {.v3s = {.x =  66, .y = 2091,  .z = 550}},
  {.v3s = {.x =  66, .y = 2091,  .z = 550}},
  {.v3s = {.x =  42, .y = 2081,  .z = 561}},
  {.v3s = {.x =  42, .y = 2081,  .z = 561}},
  {.v3s = {.x =  65, .y = 2070,  .z = 545}},
  {.v3s = {.x =  65, .y = 2070,  .z = 545}},
  {.v3s = {.x =  47, .y = 2080,  .z = 556}},
  {.v3s = {.x =  47, .y = 2080,  .z = 556}},
  {.v3s = {.x =  62, .y = 2072,  .z = 535}},
  {.v3s = {.x =  62, .y = 2072,  .z = 535}},
  {.v3s = {.x =  59, .y = 2075,  .z = 549}},
  {.v3s = {.x =  59, .y = 2075,  .z = 549}},
  {.v3s = {.x =  24, .y = 2050,  .z = 541}},
  {.v3s = {.x =  24, .y = 2050,  .z = 541}},
  {.v3s = {.x =  19, .y = 2043,  .z = 542}},
  {.v3s = {.x =  19, .y = 2043,  .z = 542}},
  {.v3s = {.x =  36, .y = 2022,  .z = 506}},
  {.v3s = {.x =  36, .y = 2022,  .z = 506}},
  {.v3s = {.x =  1,  .y = 2017,  .z = 506}},
  {.v3s = {.x =  1,  .y = 2017,  .z = 506}},
  {.v3s = {.x =  0,  .y = 2030,  .z = 525}},
  {.v3s = {.x =  0,  .y = 2030,  .z = 525}},
  {.v3s = {.x =  5,  .y = 2023,  .z = 550}},
  {.v3s = {.x =  5,  .y = 2023,  .z = 550}},
  {.v3s = {.x =  21, .y = 2008,  .z = 542}},
  {.v3s = {.x =  21, .y = 2008,  .z = 542}},
  {.v3s = {.x =  25, .y = 2025,  .z = 565}},
  {.v3s = {.x =  25, .y = 2025,  .z = 565}},
  {.v3s = {.x =  27, .y = 2021,  .z = 546}},
  {.v3s = {.x =  27, .y = 2021,  .z = 546}},
  {.v3s = {.x =  20, .y = 1996,  .z = 532}},
  {.v3s = {.x =  20, .y = 1996,  .z = 532}},
  {.v3s = {.x =  34, .y = 1979,  .z = 525}},
  {.v3s = {.x =  34, .y = 1979,  .z = 525}},
  {.v3s = {.x =  37, .y = 1985,  .z = 551}},
  {.v3s = {.x =  37, .y = 1985,  .z = 551}},
  {.v3s = {.x =  7,  .y = 1992,  .z = 521}},
  {.v3s = {.x =  7,  .y = 1992,  .z = 521}},
  {.v3s = {.x =  26, .y = 1997,  .z = 532}},
  {.v3s = {.x =  26, .y = 1997,  .z = 532}},
  {.v3s = {.x =  45, .y = 1976,  .z = 515}},
  {.v3s = {.x =  45, .y = 1976,  .z = 515}},
  {.v3s = {.x =  45, .y = 2001,  .z = 527}},
  {.v3s = {.x =  45, .y = 2001,  .z = 527}},
  {.v3s = {.x =  60, .y = 1990,  .z = 546}},
  {.v3s = {.x =  60, .y = 1990,  .z = 546}},
  {.v3s = {.x =  68, .y = 1969,  .z = 546}},
  {.v3s = {.x =  68, .y = 1969,  .z = 546}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}},
  {.v3s = {.x =  89, .y = 1996,  .z = 550}}
};

static mossfw_onedata_t gyr10[] = {
  {.v3s = {.x =  -29,  .y = -25, .z = 6 }},
  {.v3s = {.x =  -26,  .y = -32, .z = 11}},
  {.v3s = {.x =  -30,  .y = -34, .z = 15}},
  {.v3s = {.x =  -37,  .y = -38, .z = 10}},
  {.v3s = {.x =  -37,  .y = -33, .z = 15}},
  {.v3s = {.x =  -29,  .y = -31, .z = 30}},
  {.v3s = {.x =  -29,  .y = -36, .z = 15}},
  {.v3s = {.x =  -35,  .y = -35, .z = 24}},
  {.v3s = {.x =  -35,  .y = -30, .z = 24}},
  {.v3s = {.x =  -39,  .y = -39, .z = 28}},
  {.v3s = {.x =  -43,  .y = -42, .z = 31}},
  {.v3s = {.x =  -41,  .y = -35, .z = 27}},
  {.v3s = {.x =  -43,  .y = -39, .z = 45}},
  {.v3s = {.x =  -49,  .y = -38, .z = 31}},
  {.v3s = {.x =  -53,  .y = -38, .z = 44}},
  {.v3s = {.x =  -60,  .y = -37, .z = 43}},
  {.v3s = {.x =  -58,  .y = -47, .z = 47}},
  {.v3s = {.x =  -55,  .y = -42, .z = 51}},
  {.v3s = {.x =  -63,  .y = -45, .z = 64}},
  {.v3s = {.x =  -60,  .y = -45, .z = 52}},
  {.v3s = {.x =  -60,  .y = -53, .z = 48}},
  {.v3s = {.x =  -59,  .y = -52, .z = 63}},
  {.v3s = {.x =  -60,  .y = -53, .z = 58}},
  {.v3s = {.x =  -68,  .y = -50, .z = 60}},
  {.v3s = {.x =  -75,  .y = -53, .z = 63}},
  {.v3s = {.x =  -70,  .y = -53, .z = 65}},
  {.v3s = {.x =  -79,  .y = -51, .z = 70}},
  {.v3s = {.x =  -80,  .y = -53, .z = 69}},
  {.v3s = {.x =  -69,  .y = -52, .z = 69}},
  {.v3s = {.x =  -79,  .y = -52, .z = 67}},
  {.v3s = {.x =  -84,  .y = -55, .z = 81}},
  {.v3s = {.x =  -85,  .y = -55, .z = 68}},
  {.v3s = {.x =  -86,  .y = -58, .z = 62}},
  {.v3s = {.x =  -82,  .y = -57, .z = 73}},
  {.v3s = {.x =  -84,  .y = -60, .z = 73}},
  {.v3s = {.x =  -91,  .y = -66, .z = 66}},
  {.v3s = {.x =  -83,  .y = -67, .z = 67}},
  {.v3s = {.x =  -87,  .y = -70, .z = 74}},
  {.v3s = {.x =  -84,  .y = -65, .z = 70}},
  {.v3s = {.x =  -86,  .y = -66, .z = 67}},
  {.v3s = {.x =  -90,  .y = -67, .z = 74}},
  {.v3s = {.x =  -86,  .y = -68, .z = 65}},
  {.v3s = {.x =  -92,  .y = -71, .z = 65}},
  {.v3s = {.x =  -93,  .y = -75, .z = 64}},
  {.v3s = {.x =  -90,  .y = -73, .z = 63}},
  {.v3s = {.x =  -87,  .y = -71, .z = 75}},
  {.v3s = {.x =  -87,  .y = -69, .z = 72}},
  {.v3s = {.x =  -83,  .y = -69, .z = 75}},
  {.v3s = {.x =  -87,  .y = -73, .z = 65}},
  {.v3s = {.x =  -96,  .y = -68, .z = 69}},
  {.v3s = {.x =  -84,  .y = -74, .z = 70}},
  {.v3s = {.x =  -89,  .y = -79, .z = 63}},
  {.v3s = {.x =  -96,  .y = -71, .z = 56}},
  {.v3s = {.x =  -95,  .y = -83, .z = 59}},
  {.v3s = {.x =  -90,  .y = -80, .z = 51}},
  {.v3s = {.x =  -89,  .y = -79, .z = 58}},
  {.v3s = {.x =  -92,  .y = -82, .z = 53}},
  {.v3s = {.x =  -88,  .y = -79, .z = 48}},
  {.v3s = {.x =  -89,  .y = -77, .z = 53}},
  {.v3s = {.x =  -97,  .y = -79, .z = 46}},
  {.v3s = {.x =  -99,  .y = -83, .z = 53}},
  {.v3s = {.x =  -99,  .y = -83, .z = 44}},
  {.v3s = {.x =  -92,  .y = -82, .z = 39}},
  {.v3s = {.x =  -86,  .y = -75, .z = 52}},
  {.v3s = {.x =  -81,  .y = -81, .z = 40}},
  {.v3s = {.x =  -89,  .y = -88, .z = 43}},
  {.v3s = {.x =  -96,  .y = -88, .z = 42}},
  {.v3s = {.x =  -90,  .y = -83, .z = 45}},
  {.v3s = {.x =  -95,  .y = -84, .z = 40}},
  {.v3s = {.x =  -97,  .y = -80, .z = 33}},
  {.v3s = {.x =  -102, .y = -92, .z = 36}},
  {.v3s = {.x =  -87,  .y = -84, .z = 40}},
  {.v3s = {.x =  -93,  .y = -86, .z = 40}},
  {.v3s = {.x =  -104, .y = -97, .z = 45}},
  {.v3s = {.x =  -100, .y = -96, .z = 54}},
  {.v3s = {.x =  -101, .y = -92, .z = 50}},
  {.v3s = {.x =  -106, .y = -94, .z = 54}},
  {.v3s = {.x =  -106, .y = -99, .z = 57}},
  {.v3s = {.x =  -100, .y = -106,.z = 43}},
  {.v3s = {.x =  -112, .y = -108,.z = 56}},
  {.v3s = {.x =  -103, .y = -102,.z = 66}},
  {.v3s = {.x =  -104, .y = -108,.z = 61}},
  {.v3s = {.x =  -107, .y = -105,.z = 68}},
  {.v3s = {.x =  -101, .y = -106,.z = 61}},
  {.v3s = {.x =  -97,  .y = -101,.z = 56}},
  {.v3s = {.x =  -91,  .y = -101,.z = 69}},
  {.v3s = {.x =  -87,  .y = -100,.z = 65}},
  {.v3s = {.x =  -93,  .y = -95, .z = 65}},
  {.v3s = {.x =  -92,  .y = -101,.z = 69}},
  {.v3s = {.x =  -87,  .y = -97, .z = 60}},
  {.v3s = {.x =  -91,  .y = -98, .z = 75}},
  {.v3s = {.x =  -97,  .y = -102,.z = 72}},
  {.v3s = {.x =  -93,  .y = -98, .z = 68}},
  {.v3s = {.x =  -85,  .y = -97, .z = 75}},
  {.v3s = {.x =  -90,  .y = -99, .z = 72}},
  {.v3s = {.x =  -85,  .y = -93, .z = 77}},
  {.v3s = {.x =  -88,  .y = -99, .z = 71}},
  {.v3s = {.x =  -92,  .y = -101,.z = 70}},
  {.v3s = {.x =  -83,  .y = -95, .z = 73}},
  {.v3s = {.x =  -73,  .y = -96, .z = 77}},
  {.v3s = {.x =  -83,  .y = -90, .z = 70}},
  {.v3s = {.x =  -80,  .y = -89, .z = 70}},
  {.v3s = {.x =  -77,  .y = -87, .z = 72}},
  {.v3s = {.x =  -71,  .y = -85, .z = 73}},
  {.v3s = {.x =  -75,  .y = -81, .z = 63}},
  {.v3s = {.x =  -75,  .y = -74, .z = 64}},
  {.v3s = {.x =  -78,  .y = -79, .z = 64}},
  {.v3s = {.x =  -78,  .y = -79, .z = 64}},
  {.v3s = {.x =  -78,  .y = -79, .z = 64}},
  {.v3s = {.x =  -78,  .y = -79, .z = 64}},
  {.v3s = {.x =  -78,  .y = -79, .z = 64}},
  {.v3s = {.x =  -78,  .y = -79, .z = 64}},
  {.v3s = {.x =  -78,  .y = -79, .z = 64}}
};

static mossfw_onedata_t acc14[] = {
  {.v3s = {.x =  79,  .y = 1996,  .z = 543}},
  {.v3s = {.x =  79,  .y = 1996,  .z = 543}},
  {.v3s = {.x =  99,  .y = 1978,  .z = 515}},
  {.v3s = {.x =  99,  .y = 1978,  .z = 515}},
  {.v3s = {.x = 101,  .y = 1990,  .z = 551}},
  {.v3s = {.x = 101,  .y = 1990,  .z = 551}},
  {.v3s = {.x = 116,  .y = 1986,  .z = 533}},
  {.v3s = {.x = 116,  .y = 1986,  .z = 533}},
  {.v3s = {.x = 124,  .y = 1992,  .z = 527}},
  {.v3s = {.x = 124,  .y = 1992,  .z = 527}},
  {.v3s = {.x = 89,   .y = 1978,  .z = 538}},
  {.v3s = {.x = 89,   .y = 1978,  .z = 538}},
  {.v3s = {.x = 68,   .y = 1975,  .z = 538}},
  {.v3s = {.x = 68,   .y = 1975,  .z = 538}},
  {.v3s = {.x = 108,  .y = 1996,  .z = 514}},
  {.v3s = {.x = 108,  .y = 1996,  .z = 514}},
  {.v3s = {.x = 84,   .y = 1991,  .z = 554}},
  {.v3s = {.x = 84,   .y = 1991,  .z = 554}},
  {.v3s = {.x = 82,   .y = 1997,  .z = 537}},
  {.v3s = {.x = 82,   .y = 1997,  .z = 537}},
  {.v3s = {.x = 101,  .y = 1997,  .z = 541}},
  {.v3s = {.x = 101,  .y = 1997,  .z = 541}},
  {.v3s = {.x = 101,  .y = 1995,  .z = 537}},
  {.v3s = {.x = 101,  .y = 1995,  .z = 537}},
  {.v3s = {.x = 102,  .y = 2008,  .z = 519}},
  {.v3s = {.x = 102,  .y = 2008,  .z = 519}},
  {.v3s = {.x = 88,   .y = 2014,  .z = 573}},
  {.v3s = {.x = 88,   .y = 2014,  .z = 573}},
  {.v3s = {.x = 111,  .y = 2026,  .z = 561}},
  {.v3s = {.x = 111,  .y = 2026,  .z = 561}},
  {.v3s = {.x = 88,   .y = 2015,  .z = 545}},
  {.v3s = {.x = 88,   .y = 2015,  .z = 545}},
  {.v3s = {.x = 101,  .y = 2010,  .z = 558}},
  {.v3s = {.x = 101,  .y = 2010,  .z = 558}},
  {.v3s = {.x = 141,  .y = 2024,  .z = 526}},
  {.v3s = {.x = 141,  .y = 2024,  .z = 526}},
  {.v3s = {.x = 86,   .y = 2011,  .z = 554}},
  {.v3s = {.x = 86,   .y = 2011,  .z = 554}},
  {.v3s = {.x = 116,  .y = 2020,  .z = 515}},
  {.v3s = {.x = 116,  .y = 2020,  .z = 515}},
  {.v3s = {.x = 111,  .y = 2026,  .z = 529}},
  {.v3s = {.x = 111,  .y = 2026,  .z = 529}},
  {.v3s = {.x = 101,  .y = 2018,  .z = 519}},
  {.v3s = {.x = 101,  .y = 2018,  .z = 519}},
  {.v3s = {.x = 119,  .y = 2013,  .z = 521}},
  {.v3s = {.x = 119,  .y = 2013,  .z = 521}},
  {.v3s = {.x = 108,  .y = 2025,  .z = 531}},
  {.v3s = {.x = 108,  .y = 2025,  .z = 531}},
  {.v3s = {.x = 111,  .y = 2022,  .z = 546}},
  {.v3s = {.x = 111,  .y = 2022,  .z = 546}},
  {.v3s = {.x = 126,  .y = 2028,  .z = 543}},
  {.v3s = {.x = 126,  .y = 2028,  .z = 543}},
  {.v3s = {.x = 120,  .y = 2020,  .z = 526}},
  {.v3s = {.x = 120,  .y = 2020,  .z = 526}},
  {.v3s = {.x = 105,  .y = 2022,  .z = 552}},
  {.v3s = {.x = 105,  .y = 2022,  .z = 552}},
  {.v3s = {.x = 135,  .y = 2014,  .z = 534}},
  {.v3s = {.x = 135,  .y = 2014,  .z = 534}},
  {.v3s = {.x = 114,  .y = 2003,  .z = 517}},
  {.v3s = {.x = 114,  .y = 2003,  .z = 517}},
  {.v3s = {.x = 92,   .y = 2022,  .z = 528}},
  {.v3s = {.x = 92,   .y = 2022,  .z = 528}},
  {.v3s = {.x = 126,  .y = 2017,  .z = 518}},
  {.v3s = {.x = 126,  .y = 2017,  .z = 518}},
  {.v3s = {.x = 120,  .y = 2037,  .z = 544}},
  {.v3s = {.x = 120,  .y = 2037,  .z = 544}},
  {.v3s = {.x = 119,  .y = 2003,  .z = 527}},
  {.v3s = {.x = 119,  .y = 2003,  .z = 527}},
  {.v3s = {.x = 131,  .y = 2028,  .z = 510}},
  {.v3s = {.x = 131,  .y = 2028,  .z = 510}},
  {.v3s = {.x = 113,  .y = 2060,  .z = 535}},
  {.v3s = {.x = 113,  .y = 2060,  .z = 535}},
  {.v3s = {.x = 109,  .y = 2037,  .z = 523}},
  {.v3s = {.x = 109,  .y = 2037,  .z = 523}},
  {.v3s = {.x = 111,  .y = 2034,  .z = 537}},
  {.v3s = {.x = 111,  .y = 2034,  .z = 537}},
  {.v3s = {.x = 117,  .y = 2042,  .z = 514}},
  {.v3s = {.x = 117,  .y = 2042,  .z = 514}},
  {.v3s = {.x = 105,  .y = 2028,  .z = 539}},
  {.v3s = {.x = 105,  .y = 2028,  .z = 539}},
  {.v3s = {.x = 108,  .y = 2036,  .z = 533}},
  {.v3s = {.x = 108,  .y = 2036,  .z = 533}},
  {.v3s = {.x = 91,   .y = 2034,  .z = 541}},
  {.v3s = {.x = 91,   .y = 2034,  .z = 541}},
  {.v3s = {.x = 123,  .y = 2060,  .z = 509}},
  {.v3s = {.x = 123,  .y = 2060,  .z = 509}},
  {.v3s = {.x = 84,   .y = 2056,  .z = 530}},
  {.v3s = {.x = 84,   .y = 2056,  .z = 530}},
  {.v3s = {.x = 112,  .y = 2048,  .z = 534}},
  {.v3s = {.x = 112,  .y = 2048,  .z = 534}},
  {.v3s = {.x = 127,  .y = 2049,  .z = 519}},
  {.v3s = {.x = 127,  .y = 2049,  .z = 519}},
  {.v3s = {.x = 93,   .y = 2057,  .z = 531}},
  {.v3s = {.x = 93,   .y = 2057,  .z = 531}},
  {.v3s = {.x = 125,  .y = 2083,  .z = 542}},
  {.v3s = {.x = 125,  .y = 2083,  .z = 542}},
  {.v3s = {.x = 104,  .y = 2063,  .z = 538}},
  {.v3s = {.x = 104,  .y = 2063,  .z = 538}},
  {.v3s = {.x = 106,  .y = 2092,  .z = 541}},
  {.v3s = {.x = 106,  .y = 2092,  .z = 541}},
  {.v3s = {.x = 126,  .y = 2079,  .z = 520}},
  {.v3s = {.x = 126,  .y = 2079,  .z = 520}},
  {.v3s = {.x = 106,  .y = 2081,  .z = 541}},
  {.v3s = {.x = 106,  .y = 2081,  .z = 541}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}},
  {.v3s = {.x = 133,  .y = 2127,  .z = 534}}
};

static mossfw_onedata_t gyr14[] = {
  {.v3s = {.x = -67,  .y = -82,   .z = 64}},
  {.v3s = {.x = -67,  .y = -78,   .z = 70}},
  {.v3s = {.x = -75,  .y = -81,   .z = 61}},
  {.v3s = {.x = -73,  .y = -73,   .z = 55}},
  {.v3s = {.x = -74,  .y = -71,   .z = 64}},
  {.v3s = {.x = -77,  .y = -80,   .z = 66}},
  {.v3s = {.x = -77,  .y = -70,   .z = 57}},
  {.v3s = {.x = -72,  .y = -75,   .z = 56}},
  {.v3s = {.x = -77,  .y = -81,   .z = 61}},
  {.v3s = {.x = -73,  .y = -70,   .z = 67}},
  {.v3s = {.x = -81,  .y = -85,   .z = 58}},
  {.v3s = {.x = -75,  .y = -85,   .z = 61}},
  {.v3s = {.x = -77,  .y = -81,   .z = 60}},
  {.v3s = {.x = -72,  .y = -79,   .z = 67}},
  {.v3s = {.x = -79,  .y = -89,   .z = 64}},
  {.v3s = {.x = -84,  .y = -98,   .z = 60}},
  {.v3s = {.x = -86,  .y = -96,   .z = 61}},
  {.v3s = {.x = -84,  .y = -101,  .z = 62}},
  {.v3s = {.x = -80,  .y = -105,  .z = 61}},
  {.v3s = {.x = -76,  .y = -106,  .z = 60}},
  {.v3s = {.x = -79,  .y = -113,  .z = 59}},
  {.v3s = {.x = -73,  .y = -110,  .z = 58}},
  {.v3s = {.x = -74,  .y = -106,  .z = 57}},
  {.v3s = {.x = -73,  .y = -105,  .z = 55}},
  {.v3s = {.x = -65,  .y = -110,  .z = 57}},
  {.v3s = {.x = -66,  .y = -110,  .z = 59}},
  {.v3s = {.x = -64,  .y = -113,  .z = 56}},
  {.v3s = {.x = -67,  .y = -104,  .z = 56}},
  {.v3s = {.x = -64,  .y = -100,  .z = 54}},
  {.v3s = {.x = -58,  .y = -98,   .z = 52}},
  {.v3s = {.x = -59,  .y = -101,  .z = 50}},
  {.v3s = {.x = -49,  .y = -96,   .z = 53}},
  {.v3s = {.x = -50,  .y = -93,   .z = 61}},
  {.v3s = {.x = -50,  .y = -89,   .z = 58}},
  {.v3s = {.x = -47,  .y = -85,   .z = 50}},
  {.v3s = {.x = -50,  .y = -78,   .z = 55}},
  {.v3s = {.x = -51,  .y = -76,   .z = 48}},
  {.v3s = {.x = -46,  .y = -67,   .z = 50}},
  {.v3s = {.x = -41,  .y = -72,   .z = 52}},
  {.v3s = {.x = -34,  .y = -61,   .z = 49}},
  {.v3s = {.x = -37,  .y = -59,   .z = 53}},
  {.v3s = {.x = -33,  .y = -56,   .z = 48}},
  {.v3s = {.x = -33,  .y = -53,   .z = 51}},
  {.v3s = {.x = -25,  .y = -47,   .z = 49}},
  {.v3s = {.x = -19,  .y = -47,   .z = 43}},
  {.v3s = {.x = -18,  .y = -44,   .z = 53}},
  {.v3s = {.x = -18,  .y = -45,   .z = 44}},
  {.v3s = {.x = -20,  .y = -43,   .z = 37}},
  {.v3s = {.x = -25,  .y = -36,   .z = 40}},
  {.v3s = {.x = -16,  .y = -37,   .z = 37}},
  {.v3s = {.x = -12,  .y = -39,   .z = 26}},
  {.v3s = {.x = -12,  .y = -40,   .z = 34}},
  {.v3s = {.x = -18,  .y = -38,   .z = 31}},
  {.v3s = {.x = -9,   .y = -40,   .z = 27}},
  {.v3s = {.x = 1,    .y = -33,   .z = 23}},
  {.v3s = {.x = -10,  .y = -42,   .z = 24}},
  {.v3s = {.x = -12,  .y = -45,   .z = 29}},
  {.v3s = {.x = -14,  .y = -43,   .z = 28}},
  {.v3s = {.x = -11,  .y = -45,   .z = 27}},
  {.v3s = {.x = -12,  .y = -48,   .z = 21}},
  {.v3s = {.x = -12,  .y = -48,   .z = 23}},
  {.v3s = {.x = -14,  .y = -52,   .z = 22}},
  {.v3s = {.x = -14,  .y = -55,   .z = 27}},
  {.v3s = {.x = -13,  .y = -63,   .z = 17}},
  {.v3s = {.x = -15,  .y = -62,   .z = 28}},
  {.v3s = {.x = -12,  .y = -57,   .z = 26}},
  {.v3s = {.x = -9,   .y = -60,   .z = 19}},
  {.v3s = {.x = -6,   .y = -61,   .z = 22}},
  {.v3s = {.x = -9,   .y = -58,   .z = 19}},
  {.v3s = {.x = -9,   .y = -64,   .z = 23}},
  {.v3s = {.x = -9,   .y = -61,   .z = 24}},
  {.v3s = {.x = -7,   .y = -59,   .z = 23}},
  {.v3s = {.x = -12,  .y = -65,   .z = 21}},
  {.v3s = {.x = -13,  .y = -56,   .z = 17}},
  {.v3s = {.x = -7,   .y = -56,   .z = 20}},
  {.v3s = {.x = -12,  .y = -55,   .z = 23}},
  {.v3s = {.x = -7,   .y = -45,   .z = 17}},
  {.v3s = {.x = -1,   .y = -55,   .z = 24}},
  {.v3s = {.x = -3,   .y = -54,   .z = 25}},
  {.v3s = {.x = -3,   .y = -47,   .z = 22}},
  {.v3s = {.x = -5,   .y = -52,   .z = 17}},
  {.v3s = {.x = -7,   .y = -45,   .z = 20}},
  {.v3s = {.x = -3,   .y = -43,   .z = 21}},
  {.v3s = {.x = 1,    .y = -42,   .z = 23}},
  {.v3s = {.x = 5,    .y = -32,   .z = 24}},
  {.v3s = {.x = 0,    .y = -36,   .z = 19}},
  {.v3s = {.x = -1,   .y = -36,   .z = 19}},
  {.v3s = {.x = 0,    .y = -30,   .z = 15}},
  {.v3s = {.x = -8,   .y = -33,   .z = 14}},
  {.v3s = {.x = -4,   .y = -30,   .z = 14}},
  {.v3s = {.x = -1,   .y = -40,   .z = 11}},
  {.v3s = {.x = -4,   .y = -41,   .z = 11}},
  {.v3s = {.x = -2,   .y = -28,   .z = 7}},
  {.v3s = {.x = 0,    .y = -35,   .z = 6}},
  {.v3s = {.x = -4,   .y = -27,   .z = 8}},
  {.v3s = {.x = -6,   .y = -25,   .z = -2}},
  {.v3s = {.x = 3,    .y = -28,   .z = -6}},
  {.v3s = {.x = 7,    .y = -17,   .z = -2}},
  {.v3s = {.x = 5,    .y = -21,   .z = -5}},
  {.v3s = {.x = 13,   .y = -30,   .z = -3}},
  {.v3s = {.x = 6,    .y = -30,   .z = -7}},
  {.v3s = {.x = -4,   .y = -26,   .z = -14}},
  {.v3s = {.x = 0,    .y = -24,   .z = -20}},
  {.v3s = {.x = 10,   .y = -26,   .z = -20}},
  {.v3s = {.x = 2,    .y = -30,   .z = -24}},
  {.v3s = {.x = -4,   .y = -26,   .z = -23}},
  {.v3s = {.x = -4,   .y = -26,   .z = -23}},
  {.v3s = {.x = -4,   .y = -26,   .z = -23}},
  {.v3s = {.x = -4,   .y = -26,   .z = -23}},
  {.v3s = {.x = -4,   .y = -26,   .z = -23}},
  {.v3s = {.x = -4,   .y = -26,   .z = -23}},
  {.v3s = {.x = -4,   .y = -26,   .z = -23}}
};

static size_t data10_num(void)
{
  size_t acc_count = sizeof acc10 / sizeof acc10[0];
  size_t gyr_count = sizeof gyr10 / sizeof gyr10[0];

  return acc_count < gyr_count ? acc_count : gyr_count;
}

static size_t data14_num(void)
{
  size_t acc_count = sizeof acc14 / sizeof acc14[0];
  size_t gyr_count = sizeof gyr14 / sizeof gyr14[0];

  return acc_count < gyr_count ? acc_count : gyr_count;
}

static mossfw_onedata_t *acc_data10(size_t n)
{
  assert(n < sizeof acc10 / sizeof acc10[0]);
  return &acc10[n];
}

static mossfw_onedata_t *gyr_data10(size_t n)
{
  assert(n < sizeof gyr10 / sizeof gyr10[0]);
  return &gyr10[n];
}

static mossfw_onedata_t *acc_data14(size_t n)
{
  assert(n < sizeof acc14 / sizeof acc14[0]);
  return &acc14[n];
}

static mossfw_onedata_t *gyr_data14(size_t n)
{
  assert(n < sizeof gyr14 / sizeof gyr14[0]);
  return &gyr14[n];
}

static int attitude_error_source_operate_cb(struct mossfw_callback_op_s *in, unsigned long arg)
{
  int ret = 0;
  int i;
  int j;

  attitude_error_complementaryfilter_set_time_resolution(100);

  for (i = 0; i < data10_num(); i++)
    {
      mossfw_deliver_data(getattitude_errorpipeline()->attitudesource.out[1], gyr_data10(i));
      mossfw_deliver_data(getattitude_errorpipeline()->attitudesource.out[0], acc_data10(i));
    }
  attitude_error_lpf_reset();
  for (i = 0; i < data14_num(); i++)
    {
      mossfw_deliver_data(getattitude_errorpipeline()->attitudesource.out[1], gyr_data14(i));
      mossfw_deliver_data(getattitude_errorpipeline()->attitudesource.out[0], acc_data14(i));
    }

  return ret;
}

void attitude_error_source_create(struct component_s *com)
{
  if (com != NULL)
    {
      com->in_num  = 0;
      com->out_num = 2;
      com->op_num  = 1;
      com->in = NULL;
      com->out = malloc(com->out_num * sizeof(void *));
      com->op = malloc(com->op_num * sizeof(void *));
      if (allocator == NULL)
        {
          allocator = mossfw_fixedmem_create(ATTITUDESOURCE_MAXDATA * sizeof(mossfw_data_v3s_t), ATTITUDESOURCE_MAXBLOCK);
        }
      com->out[ATTITUDESOURCE_ACC]   = mossfw_output_create(ATTITUDESOURCE_ACC_OUTPUTTYPE);
      com->out[ATTITUDESOURCE_GYR]   = mossfw_output_create(ATTITUDESOURCE_GYR_OUTPUTTYPE);
      *com->op = mossfw_callback_op_create(attitude_error_source_operate_cb, 0, false);
    }
}

void attitude_error_source_delete(struct component_s *com)
{
    component_delete(com);
}

